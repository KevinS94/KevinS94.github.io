<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>
:root{
  --homeP:#2c3a63;
  --homeS:#caa24a;
  --awayP:#ffffff;
  --awayS:#8d1730;
}

html,body{
  margin:0;
  background:transparent;
  overflow:hidden;
  font-family:system-ui;
}

.wrap{
  position:absolute;
  left:50%;
  bottom:38px;
  transform:translateX(-50%);
  display:flex;
  align-items:stretch;
  height:92px;
  transition:all .3s ease;
}

.block{
  display:flex;
  align-items:center;
  transition:all .3s ease;
}

.home{
  width:520px;
  background:var(--homeP);
  color:var(--homeS);
  padding:0 18px;
  justify-content:space-between;
}

.mid{
  width:150px;
  background:#0b0c10;
  color:#fff;
  flex-direction:column;
  justify-content:center;
}

.away{
  width:520px;
  background:var(--awayP);
  color:var(--awayS);
  padding:0 18px;
  justify-content:space-between;
}

.logo{width:56px;height:56px;object-fit:contain}
.teamName{font-size:32px;font-weight:900}
.score{font-size:46px;font-weight:950}
.q,.down{font-weight:900;font-size:20px}

.tdExpand{
  width:1100px !important;
  justify-content:center !important;
  font-size:48px;
}
.hidden{display:none}
</style>
</head>
<body>

<div class="wrap" id="wrap">
  <div class="block home" id="homeBlock">
    <div style="display:flex;gap:14px;align-items:center;">
      <img id="homeLogo" class="logo">
      <div id="homeName" class="teamName"></div>
    </div>
    <div id="homeScore" class="score">0</div>
  </div>

  <div class="block mid" id="midBlock">
    <div id="q" class="q">Q1</div>
    <div id="down" class="down">1st</div>
  </div>

  <div class="block away" id="awayBlock">
    <div id="awayScore" class="score">0</div>
    <div style="display:flex;gap:14px;align-items:center;">
      <div id="awayName" class="teamName"></div>
      <img id="awayLogo" class="logo">
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL="https://lippkwxatbzmbwakifkm.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxpcHBrd3hhdGJ6bWJ3YWtpZmttIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE3ODkxNzIsImV4cCI6MjA4NzM2NTE3Mn0.QEWTN09Q_2H1OgRrJxjnlhyfjmfdp8JWpxqBshHyb7Q";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

const MATCH="2026-w1-spartans-tribes";
const BASE="https://kevins94.github.io/";

function resolveLogo(p){return BASE+p}

function ordinal(n){
  if(n==1)return"1st";
  if(n==2)return"2nd";
  if(n==3)return"3rd";
  return"4th";
}

function apply(row){
  const s=row.state||{};

  document.documentElement.style.setProperty("--homeP",row.home_primary);
  document.documentElement.style.setProperty("--homeS",row.home_secondary);
  document.documentElement.style.setProperty("--awayP",row.away_primary);
  document.documentElement.style.setProperty("--awayS",row.away_secondary);

  homeName.textContent=row.home_name;
  awayName.textContent=row.away_name;
  homeLogo.src=resolveLogo(row.home_logo);
  awayLogo.src=resolveLogo(row.away_logo);

  homeScore.textContent=s.home_score??0;
  awayScore.textContent=s.away_score??0;
  q.textContent="Q"+(s.q??1);
  down.textContent=ordinal(s.down??1);

  if(s.banner?.type==="TD" && Date.now()<s.banner.until){
    showTD(s.banner.side,row);
  } else reset();
}

function showTD(side,row){
  midBlock.classList.add("hidden");
  if(side==="home"){
    awayBlock.classList.add("hidden");
    homeBlock.classList.add("tdExpand");
    homeBlock.innerHTML="<div>TOUCHDOWN "+row.home_name+"</div>";
  }else{
    homeBlock.classList.add("hidden");
    awayBlock.classList.add("tdExpand");
    awayBlock.innerHTML="<div>TOUCHDOWN "+row.away_name+"</div>";
  }
}

function reset(){
  location.reload(); // simpel reset voor nu
}

async function load(){
  const {data}=await sb.from("match_view").select("*").eq("slug",MATCH).single();
  if(data)apply(data);
}

sb.channel("live")
.on("postgres_changes",{event:"UPDATE",schema:"public",table:"matches"},load)
.subscribe();

load();
</script>
</body>
</html>
